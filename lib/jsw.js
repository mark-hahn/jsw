// Generated by CoffeeScript 1.9.3

/*
  jsw.coffee
  A translator for an alternate Javascript syntax that uses significant whitespace
 */

(function() {
  var UglifyF, UglifyT, args, ast, codeIn, codeOut, file, fs, i, jswMappings, len, log, meta, metaStr, opts, ref, utils;

  log = require('debug')('jsw');

  fs = require('fs');

  utils = require('./utils');

  args = require('./args');

  UglifyT = require("uglify-js2-tojsw");

  UglifyF = require("uglify-js2-fromjsw");

  meta = require('./meta');

  ref = args.files;
  for (i = 0, len = ref.length; i < len; i++) {
    file = ref[i];
    console.log("\nvvvvvvvvvvvvvvvvvv");
    if (args.tojsw) {
      codeIn = fs.readFileSync(file + '.js', 'utf8');
      ast = UglifyT.parse(codeIn);
      utils.dumpAst(ast);
      fs.writeFileSync('test/ast.json', JSON.stringify(ast));
      opts = {
        beautify: true,
        indent_level: 2
      };
      if (args.map) {
        jswMappings = [];
        opts.node_map = {
          add: function(node_gen_map) {
            return jswMappings.push(node_gen_map);
          }
        };
      }
      codeOut = ast.print_to_string(opts);
      metaStr = (args.map ? meta.encode(codeIn, codeOut, jswMappings) : '');
      fs.writeFileSync(file + '.jsw', codeOut + metaStr);
    }
    if (args.fromjsw) {
      codeIn = fs.readFileSync(file + '.jsw', 'utf8');
      ast = UglifyF.parse(codeIn);
      utils.dumpAst(ast);
      fs.writeFileSync('test/ast.json', JSON.stringify(ast));
      opts = {
        beautify: true,
        indent_level: 2
      };
      codeOut = ast.print_to_string(opts);
      fs.writeFileSync(file + '.js', codeOut);
    }
    console.log("^^^^^^^^^^^^^^^^^^\n");
  }

}).call(this);
