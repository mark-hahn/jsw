// Generated by CoffeeScript 1.9.3

/*
  jsw.coffee
  A translator for an alternate Javascript syntax that uses significant whitespace
 */

(function() {
  var Uglify, args, ast, dumpAst, file, fs, i, jsIn, len, log, out, pfx, ref, streamOpts, util;

  log = require('debug')('jsw');

  fs = require('fs');

  util = require('util');

  args = require('./args');

  Uglify = require("uglify-js2");

  dumpAst = function(ast) {
    var tt;
    tt = new Uglify.TreeTransformer(null, function(node) {
      delete node.start;
      delete node.end;
      node.type = node.TYPE;
      return node;
    });
    ast = ast.transform(tt);
    fs.writeFileSync(pfx + 'dump.json', JSON.stringify(ast));
    return ast;
  };

  ref = args.files;
  for (i = 0, len = ref.length; i < len; i++) {
    file = ref[i];
    log(">>", "translating: " + file);
    pfx = 'test/';
    jsIn = fs.readFileSync(file, 'utf8');
    if (args.tojsw) {
      ast = dumpAst(Uglify.parse(jsIn));
      fs.writeFileSync(pfx + 'in-ast.json', JSON.stringify(ast));
      streamOpts = {
        beautify: true,
        indent_level: 2
      };
      out = Uglify.OutputStream(streamOpts);
      ast.print(out);
      fs.writeFileSync(pfx + 'out.js', out.toString());
    }
    log(">>", "finshed: " + file);
  }

}).call(this);
